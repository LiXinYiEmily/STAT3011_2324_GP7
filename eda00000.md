

```r
########## Exploratory Data Analysis (EDA)
```

```r
setwd("/Users/cailiying/Desktop/cuhk bsc/23:24/23:24 T2/STAT3011/Project2")
library(dlookr)
```

```
## 
## Attaching package: 'dlookr'
```

```
## The following object is masked from 'package:base':
## 
##     transform
```

```r
library(tidyverse)
```

```
## ── Attaching core tidyverse packages ────────────────────────────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.3     ✔ readr     2.1.4
## ✔ forcats   1.0.0     ✔ stringr   1.5.0
## ✔ ggplot2   3.4.3     ✔ tibble    3.2.1
## ✔ lubridate 1.9.3     ✔ tidyr     1.3.0
## ✔ purrr     1.0.2
```

```
## ── Conflicts ──────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ tidyr::extract() masks dlookr::extract()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
```

```r
library(ggcorrplot)
library(patchwork)
df <- read_csv("cs-training.csv")
```

```
## New names:
## Rows: 150000 Columns: 12
## ── Column specification
## ────────────────────────────────────────────────────────────────────────────── Delimiter: "," dbl
## (12): ...1, SeriousDlqin2yrs, RevolvingUtilizationOfUnsecuredLines, age, NumberOfTime30-59Days...
## ℹ Use `spec()` to retrieve the full column specification for this data. ℹ Specify the column types or
## set `show_col_types = FALSE` to quiet this message.
## • `` -> `...1`
```

```r
glimpse(df)
```

```
## Rows: 150,000
## Columns: 12
## $ ...1                                   <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16…
## $ SeriousDlqin2yrs                       <dbl> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
## $ RevolvingUtilizationOfUnsecuredLines   <dbl> 0.76612661, 0.95715102, 0.65818014, 0.23380978, 0.907…
## $ age                                    <dbl> 45, 40, 38, 30, 49, 74, 57, 39, 27, 57, 30, 51, 46, 4…
## $ `NumberOfTime30-59DaysPastDueNotWorse` <dbl> 2, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0,…
## $ DebtRatio                              <dbl> 8.029821e-01, 1.218762e-01, 8.511338e-02, 3.604968e-0…
## $ MonthlyIncome                          <dbl> 9120, 2600, 3042, 3300, 63588, 3500, NA, 3500, NA, 23…
## $ NumberOfOpenCreditLinesAndLoans        <dbl> 13, 4, 2, 5, 7, 3, 8, 8, 2, 9, 5, 7, 13, 9, 6, 7, 10,…
## $ NumberOfTimes90DaysLate                <dbl> 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0,…
## $ NumberRealEstateLoansOrLines           <dbl> 6, 0, 0, 0, 1, 1, 3, 0, 0, 4, 0, 2, 2, 1, 1, 1, 2, 0,…
## $ `NumberOfTime60-89DaysPastDueNotWorse` <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…
## $ NumberOfDependents                     <dbl> 2, 1, 0, 0, 0, 1, 0, 0, NA, 2, 0, 2, 2, 2, 0, 2, 0, 0…
```

```r
#Drop the column (Unnamed: 0)
df <- df[,-1]
#Clean the column names
colnames(df) <- gsub("-", "", tolower(colnames(df)))

#Check for missing values in variables
colSums(is.na(df))
```

```
##                     seriousdlqin2yrs revolvingutilizationofunsecuredlines 
##                                    0                                    0 
##                                  age  numberoftime3059dayspastduenotworse 
##                                    0                                    0 
##                            debtratio                        monthlyincome 
##                                    0                                29731 
##      numberofopencreditlinesandloans              numberoftimes90dayslate 
##                                    0                                    0 
##         numberrealestateloansorlines  numberoftime6089dayspastduenotworse 
##                                    0                                    0 
##                   numberofdependents 
##                                 3924
```

```r
#Computes the statistics of all numerical variables 
describe(df)
```

```
## # A tibble: 11 × 26
##    described_variables           n    na    mean      sd se_mean     IQR skewness kurtosis   p00   p01
##    <chr>                     <int> <int>   <dbl>   <dbl>   <dbl>   <dbl>    <dbl>    <dbl> <dbl> <dbl>
##  1 seriousdlqin2yrs         150000     0 6.68e-2 2.50e-1 6.45e-4 0          3.47   1.00e+1     0     0
##  2 revolvingutilizationofu… 150000     0 6.05e+0 2.50e+2 6.45e-1 5.29e-1   97.6    1.45e+4     0     0
##  3 age                      150000     0 5.23e+1 1.48e+1 3.81e-2 2.2 e+1    0.189 -4.95e-1     0    24
##  4 numberoftime3059dayspas… 150000     0 4.21e-1 4.19e+0 1.08e-2 0         22.6    5.22e+2     0     0
##  5 debtratio                150000     0 3.53e+2 2.04e+3 5.26e+0 6.93e-1   95.2    1.37e+4     0     0
##  6 monthlyincome            120269 29731 6.67e+3 1.44e+4 4.15e+1 4.85e+3  114.     1.95e+4     0     0
##  7 numberofopencreditlines… 150000     0 8.45e+0 5.15e+0 1.33e-2 6   e+0    1.22   3.09e+0     0     0
##  8 numberoftimes90dayslate  150000     0 2.66e-1 4.17e+0 1.08e-2 0         23.1    5.38e+2     0     0
##  9 numberrealestateloansor… 150000     0 1.02e+0 1.13e+0 2.92e-3 2   e+0    3.48   6.05e+1     0     0
## 10 numberoftime6089dayspas… 150000     0 2.40e-1 4.16e+0 1.07e-2 0         23.3    5.46e+2     0     0
## 11 numberofdependents       146076  3924 7.57e-1 1.12e+0 2.92e-3 1   e+0    1.59   3.00e+0     0     0
## # ℹ 15 more variables: p05 <dbl>, p10 <dbl>, p20 <dbl>, p25 <dbl>, p30 <dbl>, p40 <dbl>, p50 <dbl>,
## #   p60 <dbl>, p70 <dbl>, p75 <dbl>, p80 <dbl>, p90 <dbl>, p95 <dbl>, p99 <dbl>, p100 <dbl>
```

```r
df_numeric <- df %>% 
  ##select all numeric column
  select(where(is.numeric))

df_numeric %>% 
  pivot_longer(everything(),names_to = "variable",values_to = "value") %>% 
  ggplot(aes(x=value))+
  geom_histogram()+
  facet_wrap(~variable,scales = "free")+
  theme_bw()
```

```
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
```

```
## Warning: Removed 33655 rows containing non-finite values (`stat_bin()`).
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-1.png)

```r
sum_numberoftimeslate <- df$numberoftime3059dayspastduenotworse + 
  df$numberoftime6089dayspastduenotworse + df$numberoftimes90dayslate
df$prop_3059 <- df$numberoftime3059dayspastduenotworse/sum_numberoftimeslate
df$prop_6089 <- df$numberoftime6089dayspastduenotworse/sum_numberoftimeslate
df$prop_90plus <- df$numberoftimes90dayslate/sum_numberoftimeslate
#Replace 3 numberoftime columns' all NA values to 0
df[c('numberoftime3059dayspastduenotworse', 'numberoftime6089dayspastduenotworse', 'numberoftimes90dayslate')] <- 
  lapply(df[c('numberoftime3059dayspastduenotworse', 'numberoftime6089dayspastduenotworse', 'numberoftimes90dayslate')], 
         function(x) { replace(x, is.na(x), 0) })

#Create a new column 'category_pastdue' to store the classification
df$category_pastdue <- apply(df, 1, function(x) {
  #Calculate the total number of past due occurrences
  total_past_due <- x['numberoftime3059dayspastduenotworse'] + 
    x['numberoftime6089dayspastduenotworse'] + x['numberoftimes90dayslate']
  #Calculate the proportion for each time frame
  prop_3059 <- ifelse(is.na(x['numberoftime3059dayspastduenotworse'] / total_past_due), 0, 
                      x['numberoftime3059dayspastduenotworse'] / total_past_due)
  prop_6089 <- ifelse(is.na(x['numberoftime6089dayspastduenotworse'] / total_past_due), 0, 
                      x['numberoftime6089dayspastduenotworse'] / total_past_due)
  prop_90plus <- ifelse(is.na(x['numberoftimes90dayslate'] / total_past_due), 0, 
                        x['numberoftimes90dayslate'] / total_past_due)
  if (prop_3059 == 0 & 
      prop_6089 == 0 & 
      prop_90plus == 0) {
    return('No Past Due')
  } else {
    #Classify based on the proportions
    if (prop_3059 > 0.5) {
      return('Mostly 30-59 Days Past Due')
    } else if (prop_6089 > 0.3) {
      return('Mostly 60-89 Days Past Due')
    } else {
      return('Mixed Past Due')
    }
  }
})

table(df$category_pastdue)
```

```
## 
##             Mixed Past Due Mostly 30-59 Days Past Due Mostly 60-89 Days Past Due 
##                       5597                      19316                       5450 
##                No Past Due 
##                     119637
```

```r
#remove three columns
df <- subset(df, select = -c(numberoftime3059dayspastduenotworse, numberoftime6089dayspastduenotworse, numberoftimes90dayslate))

df_chr <- df %>% 
  select(where(is.character))
df_chr %>% 
  pivot_longer(everything(),names_to = "variable",values_to = "value") %>% 
  ggplot(aes(x=value))+
  geom_bar()+
  facet_wrap(~variable,scales = "free")+
  theme_bw()
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2-2.png)

```r
#have extreme values


knitr::spin()
```

```
## Error in knitr::spin(): argument "hair" is missing, with no default
```

